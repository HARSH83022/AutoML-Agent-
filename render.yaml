services:
  - type: web
    name: automl-platform
    runtime: python
    plan: free
    branch: Phase-4
    buildCommand: |
      echo "=== Installing Python dependencies ==="
      pip install --upgrade pip
      pip install -r requirements.txt
      echo "=== Checking Node.js version ==="
      node --version || echo "Node.js not found"
      npm --version || echo "npm not found"
      echo "=== Building frontend ==="
      if [ -d "frontend" ]; then
        cd frontend
        npm install || echo "npm install failed"
        npm run build || echo "npm build failed"
        cd ..
      else
        echo "Frontend directory not found"
      fi
      echo "=== Copying frontend files ==="
      mkdir -p app/static
      if [ -d "frontend/dist" ]; then 
        cp -r frontend/dist/* app/static/
        echo "Frontend copied successfully"
      else 
        echo "ERROR: frontend/dist not found - frontend build failed"
      fi
      echo "=== Contents of app/static ==="
      ls -la app/static || echo "app/static not found"
    startCommand: gunicorn -w 2 -k uvicorn.workers.UvicornWorker app.main:app --bind 0.0.0.0:$PORT --timeout 600
    envVars:
      # Application Settings
      - key: APP_ENV
        value: production
      - key: LOG_LEVEL
        value: info
      - key: LLM_MODE
        value: none
      - key: SYNTHETIC_DEFAULT_ROWS
        value: "1000"
      
      # Kaggle Credentials (set these in Render Dashboard > Environment)
      - key: KAGGLE_USERNAME
        sync: false
      - key: KAGGLE_KEY
        sync: false
